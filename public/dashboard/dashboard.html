<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConvoSpace - Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/modalPopUp.css">
    <link rel="stylesheet" href="css/shareScreenPopup.css">
    <link rel="stylesheet" href="css/audioModalPopup.css">
    <link rel="stylesheet" href="css/export-style.css">
    <link rel="stylesheet" href="css/recent-activity.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <div class="logo">
                <i class="fas fa-video"></i>
                <span>ConvoSpace</span>
            </div>
        </div>
        <div class="header-right">
            <div class="user-profile" id="userProfile">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-info">
                    <div class="user-name" id="userName">Loading...</div>
                    <div class="user-email" id="userEmail">Loading...</div>
                </div>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Stats Grid -->
        <section class="stats-section">
            <div class="stats-grid">
                <div class="stat-card primary">
                    <div class="stat-icon">
                        <i class="fas fa-phone"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalCallsNo">0</div>
                        <div class="stat-label">Total Calls</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            +12% from last month
                        </div>
                    </div>
                </div>

                <div class="stat-card success">
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="callDurationNo">0h 0m</div>
                        <div class="stat-label">Call Duration</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            +8% from last month
                        </div>
                    </div>
                </div>

                <div class="stat-card warning">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="participantsNo">0</div>
                        <div class="stat-label">Participants</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            +15% from last month
                        </div>
                    </div>
                </div>

                <div class="stat-card info">
                    <div class="stat-icon">
                        <i class="fas fa-calendar"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="meetingScheduledNo">0</div>
                        <div class="stat-label">Meetings Scheduled</div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            +5% from last month
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Quick Actions -->
        <section class="quick-actions-section">
            <h2 class="section-title">Quick Actions</h2>
            <div class="quick-actions-grid">
                <button class="quick-action-btn primary" onclick="openStartMeetingModal()">
                    <div class="action-icon">
                        <i class="fas fa-video"></i>
                    </div>
                    <div class="action-content">
                        <div class="action-title">Start Meeting</div>
                        <div class="action-desc">Create a new video meeting</div>
                    </div>
                </button>

                <button class="quick-action-btn secondary" id="audioOnlyBtn">
                    <div class="action-icon">
                        <i class="fas fa-microphone"></i>
                    </div>
                    <div class="action-content">
                        <div class="action-title">Audio Only</div>
                        <div class="action-desc">Start audio-only meeting</div>
                    </div>
                </button>

                <button class="quick-action-btn tertiary" id="shareScreenBtn">
                    <div class="action-icon">
                        <i class="fas fa-desktop"></i>
                    </div>
                    <div class="action-content">
                        <div class="action-title">Share Screen</div>
                        <div class="action-desc">Start screen sharing session</div>
                    </div>
                </button>

                <button class="quick-action-btn quaternary" onclick="openJoinMeetingModal()">
                    <div class="action-icon">
                        <i class="fas fa-sign-in-alt"></i>
                    </div>
                    <div class="action-content">
                        <div class="action-title">Join Meeting</div>
                        <div class="action-desc">Enter meeting ID to join</div>
                    </div>
                </button>
            </div>
        </section>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Recent Activity -->
            <section class="dashboard-card">
                <div class="card-header">
                    <h3>Recent Activity</h3>
                    <button class="btn btn-text" onclick="refreshRecentActivity()">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>
                <div class="card-content">
                    <div class="activity-list" id="activityList">
                        <div class="activity-loading">
                            <i class="fas fa-spinner fa-spin"></i>
                            <span>Loading activities...</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Upcoming Meetings -->
            <section class="dashboard-card">
                <div class="card-header">
                    <h3>Upcoming Meetings</h3>
                    <div class="header-actions">
                        <button class="btn btn-text" onclick="refreshUpcomingMeetings()">
                            <i class="fas fa-sync-alt"></i>
                            Refresh
                        </button>
                        <button class="btn btn-primary" onclick="openScheduleMeetingModal()">
                            <i class="fas fa-plus"></i>
                            Schedule
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div id="loadingContainer" class="loading-container">
                        <div class="loading-spinner"></div>
                        <span>Loading meetings...</span>
                    </div>
                    <div id="meetingsContainer" class="meetings-list" style="display: none;">
                        <!-- Meetings will be populated here -->
                    </div>
                    <div id="emptyState" class="empty-state" style="display: none;">
                        <i class="fas fa-calendar-times"></i>
                        <h4>No Upcoming Meetings</h4>
                        <p>Schedule your first meeting to get started</p>
                        <button class="btn btn-primary" onclick="openScheduleMeetingModal()">
                            <i class="fas fa-plus"></i>
                            Schedule Meeting
                        </button>
                    </div>
                    <div id="errorState" class="error-state" style="display: none;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h4>Failed to Load Meetings</h4>
                        <p id="errorMessage">Please try again</p>
                        <button class="btn btn-primary" onclick="refreshUpcomingMeetings()">
                            <i class="fas fa-retry"></i>
                            Try Again
                        </button>
                    </div>
                </div>
            </section>

            <!-- Export Statistics -->
            <section class="dashboard-card">
                <div class="card-header">
                    <h3>Export Statistics</h3>
                    <button class="btn btn-text" id="xp98stats-export-trigger">
                        <i class="fas fa-download"></i>
                        Export
                    </button>
                </div>
                <div class="card-content">
                    <div class="export-preview">
                        <div class="export-item">
                            <i class="fas fa-file-excel"></i>
                            <span>Excel Report</span>
                        </div>
                        <div class="export-item">
                            <i class="fas fa-file-pdf"></i>
                            <span>PDF Report</span>
                        </div>
                        <div class="export-item">
                            <i class="fas fa-file-csv"></i>
                            <span>CSV Data</span>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Start Meeting Modal -->
    <div class="modal-overlay" id="ModalPopMeetingOverlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Start New Meeting</h2>
                <button class="close-btn" onclick="closeStartMeetingModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- User Info Section -->
                <div class="user-info-schedule">
                    <div class="user-avatar" id="modalUserAvatar">U</div>
                    <div class="user-details">
                        <div class="user-label">Host</div>
                        <div class="user-name" id="modalUserName">Loading...</div>
                    </div>
                </div>

                <!-- Meeting Title -->
                <div class="title-input-section">
                    <label class="input-label">Meeting Title</label>
                    <div class="title-input-container">
                        <i class="title-input-icon fas fa-video"></i>
                        <input type="text" id="titleInput" class="title-input" placeholder="Enter meeting title">
                    </div>
                </div>

                <!-- Meeting ID Display -->
                <div class="meeting-id-section">
                    <label class="input-label">Meeting ID</label>
                    <div class="meeting-id-container">
                        <i class="meeting-id-icon fas fa-key"></i>
                        <input type="text" id="meetingIdDisplay" class="meeting-id-display" readonly placeholder="Generating...">
                        <button class="copy-btn" onclick="copyMeetingId()" title="Copy Meeting ID">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>

                <!-- Meeting Link Display -->
                <div class="meeting-link-section">
                    <label class="input-label">Meeting Link</label>
                    <div class="meeting-link-container">
                        <i class="meeting-link-icon fas fa-link"></i>
                        <input type="text" id="meetingLinkDisplay" class="meeting-link-display" readonly placeholder="Generating...">
                        <button class="copy-btn" onclick="copyMeetingLink()" title="Copy Meeting Link">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>

                <!-- Email Invitation -->
                <div class="email-input-section">
                    <label class="input-label">Invite Participants (Optional)</label>
                    <div class="email-input-container">
                        <i class="email-input-icon fas fa-envelope"></i>
                        <input type="email" id="emailInput" class="email-input" placeholder="Enter email address">
                        <button class="add-email-btn" onclick="addParticipant()">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>

                <!-- Participants List -->
                <div class="participantsName-section">
                    <div class="participantsName-header">
                        <label class="input-label">Participants</label>
                        <div class="participantsName-count" id="participantsNameCount">0 participants added</div>
                    </div>
                    <div class="participantsName-list" id="participantsNameList">
                        <div class="empty-state" id="emptyState">
                            <i class="fas fa-user-plus"></i>
                            <p>No participants added yet.<br>Enter email addresses above to get started.</p>
                        </div>
                    </div>
                </div>

                <!-- Meeting Options -->
                <div class="checkbox-group">
                    <input type="checkbox" id="startWithVideoOff">
                    <label for="startWithVideoOff">Start with video off</label>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="autoStartScreenShare">
                    <label for="autoStartScreenShare">Auto-start screen sharing</label>
                </div>

                <!-- Error/Success Messages -->
                <div class="error-message" id="errorMessage"></div>
                <div class="success-message" id="successMessage"></div>
            </div>
            <div class="modal-actions">
                <button class="cancel-btn" onclick="closeStartMeetingModal()">Cancel</button>
                <button class="start-meeting-btn" id="startMeetingBtn" onclick="createMeeting()">
                    <div class="loading-spinner" style="display: none;"></div>
                    <i class="fas fa-video" id="videoIcon"></i>
                    <span id="btnText">Start Meeting</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Audio Only Modal -->
    <div class="conference-backdrop" id="dialogBackdrop" style="display: none;">
        <div class="meeting-wrapper">
            <div class="dialog-header">
                <h2 class="dialog-heading">Audio Only Meeting</h2>
                <button class="dismiss-button" id="dismissDialog">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="field-group">
                <div class="field-wrapper">
                    <input type="text" class="text-input" id="conferenceTitle" placeholder="Meeting Title" required>
                    <label class="field-label">Meeting Title</label>
                </div>
            </div>
            <div class="field-group">
                <div class="field-wrapper">
                    <div class="email-field-wrapper">
                        <input type="email" class="text-input" id="contactInput" placeholder="Invite participants">
                        <label class="field-label">Invite Participants</label>
                    </div>
                    <button type="button" class="participant-add-btn" id="addContactBtn">
                        <i class="fas fa-plus"></i>
                        Add
                    </button>
                </div>
                <div class="attendees-section">
                    <div class="participants-label">Participants:</div>
                    <div class="participant-tags" id="attendeeChips"></div>
                </div>
            </div>
            <div class="controls-container">
                <button type="button" class="control-button dismiss-control" id="dismissControl">Cancel</button>
                <button type="submit" class="control-button start-meeting-btn" id="launchConferenceBtn">
                    <div class="loading-spinner" style="display: none;"></div>
                    <i class="fas fa-microphone"></i>
                    <span>Start Audio Meeting</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Screen Share Modal -->
    <div class="popup-overlay" id="meetingPopup">
        <div class="popup-container">
            <button class="close-btn" id="closePopup">
                <i class="fas fa-times"></i>
            </button>
            <div class="popup-header">
                <div class="popup-icon">
                    <i class="fas fa-desktop"></i>
                </div>
                <div>
                    <h2 class="popup-title">Screen Share Meeting</h2>
                    <p class="popup-subtitle">Share your screen with participants</p>
                </div>
            </div>
            <div class="form-container">
                <div class="form-group">
                    <label class="form-label">Meeting Title</label>
                    <div class="input-container">
                        <input type="text" id="meetingTitle" class="input-field" placeholder="Enter meeting title" maxlength="100">
                    </div>
                    <div class="character-count" id="characterCount">0/100 characters</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Invite Participants</label>
                    <div class="email-input-container">
                        <i class="search-icon fas fa-envelope"></i>
                        <input type="email" id="emailInputShare" class="email-input" placeholder="Enter email address">
                        <button class="add-email-btn-screenShare" id="addEmailBtn">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div class="error-message" id="errorMessage"></div>
                    <div class="selected-emails" id="selectedEmails"></div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="autoStartScreenShareOption" checked>
                    <label for="autoStartScreenShareOption">Automatically start screen sharing when meeting begins</label>
                </div>

                <div class="meeting-preview" id="meetingPreview" style="display: none;">
                    <h4>Meeting Preview</h4>
                    <p><strong>Title:</strong> <span id="previewTitle">-</span></p>
                    <p><strong>Participants:</strong> <span id="previewParticipants">0</span></p>
                    <p><strong>Screen Share:</strong> <span>Enabled</span></p>
                </div>
            </div>
            <button class="start-meeting-share" id="startmeetingnoscrn">
                <div class="btn-content">
                    <i class="fas fa-play"></i>
                    <span>Start Screen Share Meeting</span>
                </div>
            </button>
        </div>
    </div>

    <!-- Join Meeting Modal -->
    <div class="conference-backdrop" id="joinMeetingModal" style="display: none;">
        <div class="meeting-wrapper">
            <div class="dialog-header">
                <h2 class="dialog-heading">Join Meeting</h2>
                <button class="dismiss-button" onclick="closeJoinMeetingModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="field-group">
                <div class="field-wrapper">
                    <input type="text" class="text-input" id="joinMeetingId" placeholder="Enter 8-character Meeting ID" maxlength="8" required>
                    <label class="field-label">Meeting ID</label>
                </div>
                <div class="error-message" id="joinErrorMessage"></div>
            </div>
            <div class="controls-container">
                <button type="button" class="control-button dismiss-control" onclick="closeJoinMeetingModal()">Cancel</button>
                <button type="submit" class="control-button start-meeting-btn" id="joinMeetingBtn">
                    <div class="loading-spinner" style="display: none;"></div>
                    <i class="fas fa-sign-in-alt"></i>
                    <span>Join Meeting</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Schedule Meeting Modal -->
    <div class="conference-backdrop" id="scheduleMeetingModal" style="display: none;">
        <div class="meeting-wrapper">
            <div class="dialog-header">
                <h2 class="dialog-heading">Schedule Meeting</h2>
                <button class="dismiss-button" onclick="closeScheduleMeetingModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="scheduleMeetingForm">
                <div class="field-group">
                    <div class="field-wrapper">
                        <input type="text" class="text-input" id="scheduleMeetingTitle" placeholder="Meeting Title" required>
                        <label class="field-label">Meeting Title</label>
                    </div>
                </div>
                <div class="field-group">
                    <div class="field-wrapper">
                        <input type="date" class="text-input" id="scheduleMeetingDate" required>
                        <label class="field-label">Date</label>
                    </div>
                </div>
                <div class="field-group">
                    <div class="field-wrapper">
                        <input type="time" class="text-input" id="scheduleMeetingTime" required>
                        <label class="field-label">Time</label>
                    </div>
                </div>
                <div class="field-group">
                    <div class="field-wrapper">
                        <select class="text-input" id="scheduleMeetingDuration" required>
                            <option value="">Select Duration</option>
                            <option value="15">15 minutes</option>
                            <option value="30">30 minutes</option>
                            <option value="60">1 hour</option>
                            <option value="90">1.5 hours</option>
                            <option value="120">2 hours</option>
                        </select>
                        <label class="field-label">Duration</label>
                    </div>
                </div>
                <div class="field-group">
                    <div class="field-wrapper">
                        <textarea class="text-input" id="scheduleMeetingDescription" placeholder="Meeting description (optional)" rows="3"></textarea>
                        <label class="field-label">Description</label>
                    </div>
                </div>
                <div class="field-group">
                    <div class="field-wrapper">
                        <div class="email-field-wrapper">
                            <input type="email" class="text-input" id="scheduleEmailInput" placeholder="Add participants">
                            <label class="field-label">Participants</label>
                        </div>
                        <button type="button" class="participant-add-btn" onclick="addScheduleParticipant()">
                            <i class="fas fa-plus"></i>
                            Add
                        </button>
                    </div>
                    <div class="attendees-section">
                        <div class="participants-label">Participants:</div>
                        <div class="participant-tags" id="scheduleParticipantsList"></div>
                    </div>
                </div>
                <div class="error-message" id="scheduleErrorMessage"></div>
                <div class="success-message" id="scheduleSuccessMessage"></div>
                <div class="controls-container">
                    <button type="button" class="control-button dismiss-control" onclick="closeScheduleMeetingModal()">Cancel</button>
                    <button type="submit" class="control-button start-meeting-btn" id="scheduleMeetingBtn">
                        <div class="loading-spinner" style="display: none;"></div>
                        <i class="fas fa-calendar-plus"></i>
                        <span>Schedule Meeting</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="xp98stats-modal-overlay" id="xp98stats-export-modal-overlay">
        <div class="xp98stats-export-modal">
            <div class="xp98stats-modal-header">
                <h2 class="xp98stats-modal-title">
                    <i class="fas fa-download"></i>
                    Export Statistics
                </h2>
                <p class="xp98stats-modal-subtitle">Choose your preferred export format</p>
                <button class="xp98stats-close-btn" id="xp98stats-close-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="xp98stats-modal-body">
                <div class="xp98stats-success-message" id="xp98stats-success-msg" style="display: none;">
                    <i class="fas fa-check-circle"></i>
                    <span>Export completed successfully!</span>
                </div>
                
                <div class="xp98stats-format-grid">
                    <div class="xp98stats-format-option" data-format="xlsx">
                        <i class="fas fa-file-excel xp98stats-format-icon"></i>
                        <h3 class="xp98stats-format-name">Excel</h3>
                        <p class="xp98stats-format-desc">Spreadsheet format with charts and formulas</p>
                    </div>
                    
                    <div class="xp98stats-format-option" data-format="pdf">
                        <i class="fas fa-file-pdf xp98stats-format-icon"></i>
                        <h3 class="xp98stats-format-name">PDF</h3>
                        <p class="xp98stats-format-desc">Professional report with tables and graphs</p>
                    </div>
                    
                    <div class="xp98stats-format-option" data-format="csv">
                        <i class="fas fa-file-csv xp98stats-format-icon"></i>
                        <h3 class="xp98stats-format-name">CSV</h3>
                        <p class="xp98stats-format-desc">Raw data for analysis and import</p>
                    </div>
                    
                    <div class="xp98stats-format-option" data-format="json">
                        <i class="fas fa-file-code xp98stats-format-icon"></i>
                        <h3 class="xp98stats-format-name">JSON</h3>
                        <p class="xp98stats-format-desc">Structured data for developers</p>
                    </div>
                    
                    <div class="xp98stats-format-option" data-format="txt">
                        <i class="fas fa-file-alt xp98stats-format-icon"></i>
                        <h3 class="xp98stats-format-name">Text</h3>
                        <p class="xp98stats-format-desc">Simple text format for basic reports</p>
                    </div>
                    
                    <div class="xp98stats-format-option" data-format="docx">
                        <i class="fas fa-file-word xp98stats-format-icon"></i>
                        <h3 class="xp98stats-format-name">Word</h3>
                        <p class="xp98stats-format-desc">Document format for detailed reports</p>
                    </div>
                </div>
            </div>
            <div class="xp98stats-modal-actions">
                <button class="xp98stats-btn xp98stats-btn-secondary" id="xp98stats-cancel-btn">
                    <i class="fas fa-times"></i>
                    <span>Cancel</span>
                </button>
                <button class="xp98stats-btn xp98stats-btn-primary" id="xp98stats-export-btn" disabled>
                    <i class="fas fa-download"></i>
                    <span id="xp98stats-export-btn-text">Export Report</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/modalHandler.js"></script>
    <script src="js/audioModalPopup.js"></script>
    <script src="js/screenSharePopUp.js"></script>
    <script src="js/export-style.js"></script>
    <script src="js/recentActivity.js"></script>
    <script src="js/upcomingMeetings.js"></script>
    <script src="js/updateMeetingCount.js"></script>
    <script src="js/meetingStats.js"></script>
</body>
</html>